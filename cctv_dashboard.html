<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYNO Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --success-color: #27ae60;
            --info-color: #3498db;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .main-container {
            padding: 30px 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: none;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card-header-custom {
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .badge-critical { background: var(--danger-color); }
        .badge-high { background: var(--warning-color); }
        .badge-medium { background: var(--info-color); }
        .badge-low { background: var(--success-color); }

        .scan-controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .device-row {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .device-row:hover {
            background-color: #f8f9fa;
            transform: scale(1.01);
        }

        .progress-bar-animated {
            animation: progress-bar-stripes 1s linear infinite;
        }

        .btn-scan {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-scan:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .vulnerability-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid;
            transition: all 0.2s ease;
        }

        .vulnerability-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .vuln-critical { border-left-color: var(--danger-color); background: #fee; }
        .vuln-high { border-left-color: var(--warning-color); background: #fff3e0; }
        .vuln-medium { border-left-color: var(--info-color); background: #e3f2fd; }
        .vuln-low { border-left-color: var(--success-color); background: #e8f5e9; }

        .scan-status {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }

        .filter-chip {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            background: #ecf0f1;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-chip:hover, .filter-chip.active {
            background: var(--secondary-color);
            color: white;
            transform: scale(1.05);
        }

        .modal-content {
            border-radius: 15px;
            border: none;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .device-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .mitigation-steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .exploitation-steps {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .risk-meter {
            height: 30px;
            border-radius: 15px;
            background: linear-gradient(to right, #27ae60, #f39c12, #e74c3c);
            position: relative;
            margin: 20px 0;
        }

        .risk-indicator {
            position: absolute;
            width: 10px;
            height: 40px;
            background: white;
            border: 2px solid #2c3e50;
            border-radius: 5px;
            top: -5px;
            transition: left 0.5s ease;
        }

        .tabs-custom {
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }

        .tab-custom {
            padding: 10px 20px;
            cursor: pointer;
            display: inline-block;
            margin-right: 10px;
            border-radius: 5px 5px 0 0;
            transition: all 0.2s ease;
        }

        .tab-custom:hover {
            background: #f8f9fa;
        }

        .tab-custom.active {
            background: var(--secondary-color);
            color: white;
        }

        .export-btn {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark sticky-top">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-shield-alt"></i> RYNO
            </span>
            <div>
                <button class="btn btn-outline-light btn-sm" onclick="exportData('json')">
                    <i class="fas fa-download"></i> Export JSON
                </button>
                <button class="btn btn-outline-light btn-sm export-btn" onclick="exportData('csv')">
                    <i class="fas fa-file-csv"></i> Export CSV
                </button>
                <button class="btn btn-outline-light btn-sm export-btn" onclick="showSettings()">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>
        </div>
    </nav>

    <!-- Scan Status Alert -->
    <div id="scanStatus" class="scan-status" style="display: none;">
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            <strong><i class="fas fa-spinner fa-spin"></i> Scanning...</strong>
            <p class="mb-0">Discovering devices on network</p>
            <button type="button" class="btn-close" onclick="closeScanStatus()"></button>
        </div>
    </div>

    <div class="container-fluid main-container">
        <!-- Scan Controls -->
        <div class="row">
            <div class="col-12">
                <div class="scan-controls">
                    <h4><i class="fas fa-search"></i> Network Scanner</h4>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <label>Target IP Range</label>
                            <input type="text" class="form-control" id="ipRange" placeholder="192.168.1.0/24" value="192.168.1.0/24">
                        </div>
                        <div class="col-md-3">
                            <label>Ports</label>
                            <input type="text" class="form-control" id="ports" placeholder="80,554,8000" value="80,554,8000,8080">
                        </div>
                        <div class="col-md-3">
                            <label>Scan Type</label>
                            <select class="form-select" id="scanType">
                                <option value="full">Full Assessment</option>
                                <option value="quick">Quick Scan</option>
                                <option value="deep">Deep Scan</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-scan w-100" onclick="startScan()">
                                <i class="fas fa-play"></i> Start Scan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row">
            <div class="col-md-3">
                <div class="stat-card text-center animate__animated animate__fadeIn">
                    <div class="device-icon"><i class="fas fa-video text-primary"></i></div>
                    <div class="stat-number text-primary" id="totalDevices">0</div>
                    <div class="stat-label">Total Devices</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card text-center animate__animated animate__fadeIn" style="animation-delay: 0.1s">
                    <div class="device-icon"><i class="fas fa-exclamation-triangle text-danger"></i></div>
                    <div class="stat-number text-danger" id="criticalVulns">0</div>
                    <div class="stat-label">Critical Issues</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card text-center animate__animated animate__fadeIn" style="animation-delay: 0.2s">
                    <div class="device-icon"><i class="fas fa-exclamation-circle text-warning"></i></div>
                    <div class="stat-number text-warning" id="highVulns">0</div>
                    <div class="stat-label">High Priority</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card text-center animate__animated animate__fadeIn" style="animation-delay: 0.3s">
                    <div class="device-icon"><i class="fas fa-shield-alt text-success"></i></div>
                    <div class="stat-number text-success" id="secureDevices">0</div>
                    <div class="stat-label">Secure Devices</div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row">
            <div class="col-md-4">
                <div class="content-card">
                    <div class="card-header-custom">
                        <h5><i class="fas fa-chart-pie"></i> Vulnerability Severity</h5>
                    </div>
                    <div class="chart-container">
                        <canvas id="severityChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="content-card">
                    <div class="card-header-custom">
                        <h5><i class="fas fa-chart-bar"></i> Devices by Vendor</h5>
                    </div>
                    <div class="chart-container">
                        <canvas id="vendorChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="content-card">
                    <div class="card-header-custom">
                        <h5><i class="fas fa-chart-line"></i> Risk Trend</h5>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Tabs -->
        <div class="row">
            <div class="col-12">
                <div class="content-card">
                    <div class="tabs-custom">
                        <span class="tab-custom active" onclick="switchTab('devices')">
                            <i class="fas fa-video"></i> Discovered Devices
                        </span>
                        <span class="tab-custom" onclick="switchTab('vulnerabilities')">
                            <i class="fas fa-bug"></i> Vulnerabilities
                        </span>
                        <span class="tab-custom" onclick="switchTab('recommendations')">
                            <i class="fas fa-lightbulb"></i> Recommendations
                        </span>
                        <span class="tab-custom" onclick="switchTab('reports')">
                            <i class="fas fa-file-alt"></i> Reports
                        </span>
                    </div>

                    <!-- Devices Tab -->
                    <div id="devicesTab" class="tab-content">
                        <div class="mb-3">
                            <input type="text" class="form-control" id="deviceSearch" placeholder="Search devices..." onkeyup="filterDevices()">
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>IP Address</th>
                                        <th>Vendor</th>
                                        <th>Model</th>
                                        <th>Firmware</th>
                                        <th>Ports</th>
                                        <th>Risk Level</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="devicesTableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Vulnerabilities Tab -->
                    <div id="vulnerabilitiesTab" class="tab-content" style="display: none;">
                        <div class="mb-3">
                            <span class="filter-chip active" onclick="filterVulnerabilities('all')">All</span>
                            <span class="filter-chip" onclick="filterVulnerabilities('CRITICAL')">Critical</span>
                            <span class="filter-chip" onclick="filterVulnerabilities('HIGH')">High</span>
                            <span class="filter-chip" onclick="filterVulnerabilities('MEDIUM')">Medium</span>
                            <span class="filter-chip" onclick="filterVulnerabilities('LOW')">Low</span>
                        </div>
                        <div id="vulnerabilitiesList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Recommendations Tab -->
                    <div id="recommendationsTab" class="tab-content" style="display: none;">
                        <div id="recommendationsList">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="reportsTab" class="tab-content" style="display: none;">
                        <h5>Generate Reports</h5>
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <div class="card text-center p-3">
                                    <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                    <h6>Executive Summary</h6>
                                    <button class="btn btn-sm btn-outline-danger mt-2" onclick="generateReport('executive')">Generate PDF</button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center p-3">
                                    <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                    <h6>Technical Report</h6>
                                    <button class="btn btn-sm btn-outline-success mt-2" onclick="generateReport('technical')">Generate Excel</button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center p-3">
                                    <i class="fas fa-file-code fa-3x text-primary mb-3"></i>
                                    <h6>Raw Data</h6>
                                    <button class="btn btn-sm btn-outline-primary mt-2" onclick="generateReport('raw')">Download JSON</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Details Modal -->
    <div class="modal fade" id="deviceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-video"></i> Device Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="deviceModalBody">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Vulnerability Details Modal -->
    <div class="modal fade" id="vulnModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-bug"></i> Vulnerability Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="vulnModalBody">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample data
        let sampleData = {
            devices: [
                {
                    ip: "192.168.1.100",
                    vendor: "Hikvision",
                    model: "DS-2CD2042WD-I",
                    firmware: "5.4.0",
                    ports: [80, 554, 8000],
                    risk: "CRITICAL"
                },
                {
                    ip: "192.168.1.101",
                    vendor: "Dahua",
                    model: "IPC-HFW4431R-Z",
                    firmware: "2.800.0000000.18.R",
                    ports: [80, 554, 37777],
                    risk: "HIGH"
                },
                {
                    ip: "192.168.1.102",
                    vendor: "Axis",
                    model: "M3046-V",
                    firmware: "9.80.1",
                    ports: [80, 443, 554],
                    risk: "MEDIUM"
                },
                {
                    ip: "192.168.1.103",
                    vendor: "Hikvision",
                    model: "DS-2CD2385G1-I",
                    firmware: "5.5.82",
                    ports: [80, 554],
                    risk: "HIGH"
                }
            ],
            vulnerabilities: [
                {
                    ip: "192.168.1.100",
                    vendor: "Hikvision",
                    cve: "CVE-2021-36260",
                    severity: "CRITICAL",
                    description: "Authentication bypass vulnerability allows unauthorized access",
                    exploitSteps: [
                        "Identify Hikvision device version",
                        "Send crafted HTTP request to bypass authentication",
                        "Access admin panel without credentials",
                        "Exploit configuration API endpoints"
                    ],
                    mitigations: [
                        "Update firmware to latest version immediately",
                        "Implement network segmentation for cameras",
                        "Enable firewall rules to restrict access",
                        "Monitor authentication logs for anomalies"
                    ]
                },
                {
                    ip: "192.168.1.100",
                    cve: "CVE-2017-7921",
                    severity: "HIGH",
                    description: "Backdoor account exists in firmware",
                    exploitSteps: [
                        "Connect to device on port 80",
                        "Use backdoor account credentials",
                        "Access full system privileges"
                    ],
                    mitigations: [
                        "Update firmware to patched version",
                        "Change all default credentials",
                        "Disable unused accounts"
                    ]
                },
                {
                    ip: "192.168.1.101",
                    cve: "CVE-2021-33044",
                    severity: "CRITICAL",
                    description: "Authentication bypass via crafted request",
                    exploitSteps: [
                        "Craft malicious HTTP request",
                        "Send to vulnerable endpoint",
                        "Gain administrative access"
                    ],
                    mitigations: [
                        "Apply security patch immediately",
                        "Restrict network access",
                        "Enable additional authentication"
                    ]
                },
                {
                    ip: "192.168.1.102",
                    cve: "CVE-2018-10660",
                    severity: "MEDIUM",
                    description: "Information disclosure vulnerability",
                    exploitSteps: [
                        "Access specific URL path",
                        "Extract sensitive information"
                    ],
                    mitigations: [
                        "Update to latest firmware",
                        "Configure access controls"
                    ]
                }
            ]
        };

        let charts = {};
        let currentFilter = 'all';

        // Initialize dashboard
        function initDashboard() {
            updateStatistics();
            createCharts();
            loadDevicesTable();
            loadVulnerabilities();
            loadRecommendations();
        }

        // Update statistics
        function updateStatistics() {
            document.getElementById('totalDevices').textContent = sampleData.devices.length;
            
            let criticalCount = sampleData.vulnerabilities.filter(v => v.severity === 'CRITICAL').length;
            let highCount = sampleData.vulnerabilities.filter(v => v.severity === 'HIGH').length;
            
            document.getElementById('criticalVulns').textContent = criticalCount;
            document.getElementById('highVulns').textContent = highCount;
            
            let secureDevices = sampleData.devices.filter(d => d.risk === 'LOW').length;
            document.getElementById('secureDevices').textContent = secureDevices;
        }

        // Create charts
        function createCharts() {
            // Severity Chart
            const severityCtx = document.getElementById('severityChart').getContext('2d');
            const severityCounts = {
                CRITICAL: sampleData.vulnerabilities.filter(v => v.severity === 'CRITICAL').length,
                HIGH: sampleData.vulnerabilities.filter(v => v.severity === 'HIGH').length,
                MEDIUM: sampleData.vulnerabilities.filter(v => v.severity === 'MEDIUM').length,
                LOW: sampleData.vulnerabilities.filter(v => v.severity === 'LOW').length
            };

            charts.severity = new Chart(severityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    datasets: [{
                        data: [severityCounts.CRITICAL, severityCounts.HIGH, severityCounts.MEDIUM, severityCounts.LOW],
                        backgroundColor: ['#e74c3c', '#f39c12', '#3498db', '#27ae60']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Vendor Chart
            const vendorCtx = document.getElementById('vendorChart').getContext('2d');
            const vendorCounts = {};
            sampleData.devices.forEach(d => {
                vendorCounts[d.vendor] = (vendorCounts[d.vendor] || 0) + 1;
            });

            charts.vendor = new Chart(vendorCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(vendorCounts),
                    datasets: [{
                        label: 'Device Count',
                        data: Object.values(vendorCounts),
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Trend Chart
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            charts.trend = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
                    datasets: [{
                        label: 'Vulnerabilities',
                        data: [12, 15, 13, 18, 16, 14, 11],
                        borderColor: '#e74c3c',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Load devices table
        function loadDevicesTable() {
            const tbody = document.getElementById('devicesTableBody');
            tbody.innerHTML = '';

            sampleData.devices.forEach(device => {
                const riskBadge = getRiskBadge(device.risk);
                const row = `
                    <tr class="device-row" onclick="showDeviceDetails('${device.ip}')">
                        <td><strong>${device.ip}</strong></td>
                        <td><i class="fas fa-video text-primary"></i> ${device.vendor}</td>
                        <td>${device.model}</td>
                        <td><span class="badge bg-secondary">${device.firmware}</span></td>
                        <td>${device.ports.join(', ')}</td>
                        <td>${riskBadge}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); testDevice('${device.ip}')">
                                <i class="fas fa-flask"></i> Test
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Load vulnerabilities
        function loadVulnerabilities() {
            const container = document.getElementById('vulnerabilitiesList');
            container.innerHTML = '';

            let vulnsToShow = currentFilter === 'all' ? 
                sampleData.vulnerabilities : 
                sampleData.vulnerabilities.filter(v => v.severity === currentFilter);

            vulnsToShow.forEach(vuln => {
                const vulnClass = `vuln-${vuln.severity.toLowerCase()}`;
                const vulnItem = `
                    <div class="vulnerability-item ${vulnClass}" onclick="showVulnDetails('${vuln.cve}')">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6><i class="fas fa-bug"></i> ${vuln.cve}</h6>
                                <p class="mb-1"><strong>Device:</strong> ${vuln.ip}</p>
                                <p class="mb-1">${vuln.description}</p>
                            </div>
                            <span class="badge badge-${vuln.severity.toLowerCase()}">${vuln.severity}</span>
                        </div>
                    </div>
                `;
                container.innerHTML += vulnItem;
            });
        }

        // Load recommendations
        function loadRecommendations() {
            const container = document.getElementById('recommendationsList');
            const recommendations = [
                {
                    priority: "CRITICAL",
                    title: "Update Hikvision Firmware Immediately",
                    affectedDevices: 2,
                    description: "Multiple Hikvision devices running vulnerable firmware versions. CVE-2021-36260 allows authentication bypass.",
                    steps: [
                        "Download latest firmware from official Hikvision website",
                        "Backup current device configurations",
                        "Apply firmware update during maintenance window",
                        "Verify update and test functionality",
                        "Monitor for any anomalies post-update"
                    ]
                },
                {
                    priority: "HIGH",
                    title: "Change Default Credentials",
                    affectedDevices: 3,
                    description: "Several devices still using default or weak credentials.",
                    steps: [
                        "Generate strong passwords (minimum 16 characters)",
                        "Update credentials on all affected devices",
                        "Document new credentials in secure password manager",
                        "Enable account lockout policies",
                        "Implement multi-factor authentication where available"
                    ]
                },
                {
                    priority: "HIGH",
                    title: "Implement Network Segmentation",
                    affectedDevices: 4,
                    description: "All CCTV devices on same network segment as other systems.",
                    steps: [
                        "Create dedicated VLAN for surveillance systems",
                        "Configure firewall rules to restrict access",
                        "Implement access control lists (ACLs)",
                        "Monitor inter-VLAN traffic",
                        "Document network topology changes"
                    ]
                },
                {
                    priority: "MEDIUM",
                    title: "Close Unnecessary Ports",
                    affectedDevices: 2,
                    description: "Devices have unnecessary ports exposed (Telnet, FTP).",
                    steps: [
                        "Audit all open ports on each device",
                        "Close ports 21, 23, and other legacy protocols",
                        "Use secure alternatives (SFTP, SSH)",
                        "Update firewall rules",
                        "Schedule regular port scans"
                    ]
                }
            ];

            container.innerHTML = '';
            recommendations.forEach((rec, index) => {
                const priorityClass = rec.priority.toLowerCase();
                const recCard = `
                    <div class="card mb-3 border-${priorityClass === 'critical' ? 'danger' : priorityClass === 'high' ? 'warning' : 'info'}">
                        <div class="card-header bg-${priorityClass === 'critical' ? 'danger' : priorityClass === 'high' ? 'warning' : 'info'} text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-exclamation-triangle"></i> ${rec.title}
                                <span class="badge bg-light text-dark float-end">${rec.affectedDevices} devices</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <p>${rec.description}</p>
                            <h6 class="mt-3">Remediation Steps:</h6>
                            <ol class="mb-0">
                                ${rec.steps.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                            <button class="btn btn-sm btn-outline-primary mt-3" onclick="exportRecommendation(${index})">
                                <i class="fas fa-file-export"></i> Export Action Plan
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += recCard;
            });
        }

        // Show device details
        function showDeviceDetails(ip) {
            const device = sampleData.devices.find(d => d.ip === ip);
            const vulnerabilities = sampleData.vulnerabilities.filter(v => v.ip === ip);
            
            let vulnList = vulnerabilities.length > 0 ? 
                vulnerabilities.map(v => `
                    <div class="alert alert-${v.severity === 'CRITICAL' ? 'danger' : 'warning'} mb-2">
                        <strong>${v.cve}</strong>: ${v.description}
                    </div>
                `).join('') : '<p class="text-success">No vulnerabilities detected</p>';

            const modalBody = `
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-info-circle"></i> Device Information</h6>
                        <table class="table table-sm">
                            <tr><td><strong>IP Address:</strong></td><td>${device.ip}</td></tr>
                            <tr><td><strong>Vendor:</strong></td><td>${device.vendor}</td></tr>
                            <tr><td><strong>Model:</strong></td><td>${device.model}</td></tr>
                            <tr><td><strong>Firmware:</strong></td><td>${device.firmware}</td></tr>
                            <tr><td><strong>Open Ports:</strong></td><td>${device.ports.join(', ')}</td></tr>
                            <tr><td><strong>Risk Level:</strong></td><td>${getRiskBadge(device.risk)}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-bug"></i> Vulnerabilities Found</h6>
                        ${vulnList}
                        <button class="btn btn-primary btn-sm w-100 mt-2" onclick="penetrationTest('${device.ip}')">
                            <i class="fas fa-vial"></i> Run Penetration Test
                        </button>
                    </div>
                </div>
                <div class="mt-3">
                    <h6><i class="fas fa-chart-line"></i> Risk Assessment</h6>
                    <div class="risk-meter">
                        <div class="risk-indicator" style="left: ${getRiskPosition(device.risk)}%"></div>
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                        <small>Low Risk</small>
                        <small>Medium Risk</small>
                        <small>High Risk</small>
                    </div>
                </div>
            `;

            document.getElementById('deviceModalBody').innerHTML = modalBody;
            new bootstrap.Modal(document.getElementById('deviceModal')).show();
        }

        // Show vulnerability details
        function showVulnDetails(cve) {
            const vuln = sampleData.vulnerabilities.find(v => v.cve === cve);
            
            const modalBody = `
                <div class="alert alert-${vuln.severity === 'CRITICAL' ? 'danger' : 'warning'}">
                    <h5><i class="fas fa-exclamation-triangle"></i> ${cve}</h5>
                    <p class="mb-0"><strong>Severity:</strong> ${vuln.severity}</p>
                    <p class="mb-0"><strong>Affected Device:</strong> ${vuln.ip}</p>
                </div>

                <h6 class="mt-3"><i class="fas fa-info-circle"></i> Description</h6>
                <p>${vuln.description}</p>

                <div class="exploitation-steps">
                    <h6><i class="fas fa-skull-crossbones"></i> Exploitation Methodology</h6>
                    <ol>
                        ${vuln.exploitSteps.map(step => `<li>${step}</li>`).join('')}
                    </ol>
                    <p class="text-danger mb-0"><i class="fas fa-exclamation-circle"></i> <strong>Warning:</strong> For authorized testing only</p>
                </div>

                <div class="mitigation-steps">
                    <h6><i class="fas fa-shield-alt"></i> Mitigation Recommendations</h6>
                    <ol>
                        ${vuln.mitigations.map(step => `<li>${step}</li>`).join('')}
                    </ol>
                </div>

                <div class="mt-3">
                    <button class="btn btn-primary" onclick="applyFix('${cve}')">
                        <i class="fas fa-wrench"></i> Apply Automated Fix
                    </button>
                    <button class="btn btn-info" onclick="window.open('https://nvd.nist.gov/vuln/detail/${cve}', '_blank')">
                        <i class="fas fa-external-link-alt"></i> View CVE Details
                    </button>
                </div>
            `;

            document.getElementById('vulnModalBody').innerHTML = modalBody;
            new bootstrap.Modal(document.getElementById('vulnModal')).show();
        }

        // Helper functions
        function getRiskBadge(risk) {
            const badges = {
                'CRITICAL': '<span class="badge badge-critical">CRITICAL</span>',
                'HIGH': '<span class="badge badge-high">HIGH</span>',
                'MEDIUM': '<span class="badge badge-medium">MEDIUM</span>',
                'LOW': '<span class="badge badge-low">LOW</span>'
            };
            return badges[risk] || badges['MEDIUM'];
        }

        function getRiskPosition(risk) {
            const positions = {
                'LOW': 15,
                'MEDIUM': 50,
                'HIGH': 75,
                'CRITICAL': 90
            };
            return positions[risk] || 50;
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab-custom').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
        }

        // Filter functions
        function filterDevices() {
            const searchTerm = document.getElementById('deviceSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#devicesTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterVulnerabilities(severity) {
            currentFilter = severity;
            
            // Update active filter chip
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadVulnerabilities();
        }

        // Scan functions
        function startScan() {
            const ipRange = document.getElementById('ipRange').value;
            const ports = document.getElementById('ports').value;
            const scanType = document.getElementById('scanType').value;

            // Show scan status
            document.getElementById('scanStatus').style.display = 'block';

            // Simulate scan
            let progress = 0;
            const scanInterval = setInterval(() => {
                progress += 10;
                if (progress >= 100) {
                    clearInterval(scanInterval);
                    document.getElementById('scanStatus').querySelector('.alert').classList.remove('alert-info');
                    document.getElementById('scanStatus').querySelector('.alert').classList.add('alert-success');
                    document.getElementById('scanStatus').querySelector('strong').innerHTML = '<i class="fas fa-check-circle"></i> Scan Complete!';
                    document.getElementById('scanStatus').querySelector('p').textContent = `Found ${sampleData.devices.length} devices with ${sampleData.vulnerabilities.length} vulnerabilities`;
                    
                    // Refresh data
                    setTimeout(() => {
                        initDashboard();
                        closeScanStatus();
                    }, 3000);
                }
            }, 500);

            console.log(`Starting ${scanType} scan on ${ipRange} for ports ${ports}`);
        }

        function closeScanStatus() {
            document.getElementById('scanStatus').style.display = 'none';
        }

        function testDevice(ip) {
            alert(`Running penetration test on device ${ip}...\n\nThis would normally:\n- Test for default credentials\n- Check for known exploits\n- Verify security configurations\n- Generate detailed test report`);
        }

        function penetrationTest(ip) {
            alert(`Initiating comprehensive penetration test on ${ip}...\n\nTest modules:\n✓ Authentication bypass\n✓ Privilege escalation\n✓ Network exposure\n✓ Firmware vulnerabilities\n✓ Configuration weaknesses`);
        }

        function applyFix(cve) {
            if (confirm(`Apply automated fix for ${cve}?\n\nThis will:\n- Update firmware if available\n- Change default credentials\n- Configure firewall rules\n- Apply security patches`)) {
                alert('Automated remediation initiated. Progress will be tracked in the Reports tab.');
            }
        }

        // Export functions
        function exportData(format) {
            if (format === 'json') {
                const dataStr = JSON.stringify(sampleData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `cctv_assessment_${new Date().getTime()}.json`;
                link.click();
            } else if (format === 'csv') {
                let csv = 'IP,Vendor,Model,Firmware,Risk,Vulnerabilities\n';
                sampleData.devices.forEach(device => {
                    const vulnCount = sampleData.vulnerabilities.filter(v => v.ip === device.ip).length;
                    csv += `${device.ip},${device.vendor},${device.model},${device.firmware},${device.risk},${vulnCount}\n`;
                });
                
                const blob = new Blob([csv], {type: 'text/csv'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `cctv_devices_${new Date().getTime()}.csv`;
                link.click();
            }
        }

        function exportRecommendation(index) {
            alert('Exporting detailed action plan...\nThis would generate a PDF document with step-by-step remediation instructions.');
        }

        function generateReport(type) {
            const messages = {
                'executive': 'Generating executive summary PDF with:\n- High-level findings\n- Risk summary\n- Business impact\n- Recommendations overview',
                'technical': 'Generating technical Excel report with:\n- Detailed vulnerability list\n- Device inventory\n- Exploitation details\n- Remediation steps',
                'raw': 'Downloading raw JSON data with complete scan results...'
            };
            
            alert(messages[type]);
            
            if (type === 'raw') {
                exportData('json');
            }
        }

        function showSettings() {
            alert('Settings Panel\n\n• Scan Configuration\n• Alert Thresholds\n• Report Templates\n• API Integration\n• User Preferences\n• Notification Settings');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();
            
            // Auto-refresh every 30 seconds
            setInterval(() => {
                updateStatistics();
            }, 30000);
        });
    </script>
</body>
</html>